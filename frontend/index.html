<html>
<head>
</head>
<body>
<canvas id="viewer"></canvas>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script type="text/javascript">

  // This file assumes the backend is running on the same server at port 3000
  backendServerURL = 'http://' + window.location.hostname + ':3000';
  console.log("connecting to " + backendServerURL);
  var socket = io(backendServerURL);

  var ctx = document.querySelector('#viewer').getContext('2d');

  // Keep the canvas full-screen and with 0,0 in the center of the screen
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas, false);
  function resizeCanvas() {
    var width  = document.body.offsetWidth;  // your code here
    var height = document.body.offsetHeight; // your code here
    ctx.canvas.width  = width;
    ctx.canvas.height = height;
    ctx.translate(width/2,height/2); // now 0,0 is the center of the canvas.
  }

  // Listen for clicks, send the click coordinates to the flare backend server
  document.getElementById("viewer").addEventListener("click", function( event ) {
    xCoord = getTranslatedCursorPositionX(ctx, event.clientX);
    yCoord = getTranslatedCursorPositionY(ctx, event.clientY);
    var coordinates = [xCoord, yCoord]
    socket.emit('click', coordinates);
  }, false);

  // Listen for flares from the backend server, display them on screen
  socket.on('flare', function(msg){
    var coordinates = msg;
    var xCoord = coordinates[0];
    var yCoord = coordinates[1];
    if (isNumeric(xCoord) && isNumeric(yCoord)) {
      ctx.beginPath();
      ctx.arc(xCoord,yCoord,40,0,2*Math.PI);
      ctx.stroke();
    }
  });

  function getTranslatedCursorPositionX(ctx, globalX) {
    return globalX - ctx.canvas.width/2
  }

  function getTranslatedCursorPositionY(ctx, globalY) {
    return globalY - ctx.canvas.height/2
  }

  function isNumeric(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
  }

</script>
</body>
</html>
